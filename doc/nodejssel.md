# Nodejs的优点和缺点

作者：FengqiAsia
编辑：reco

要讲清楚这个问题，先讲讲整个Web应用程序架构中的瓶颈。一个常见的瓶颈在于服务器能够处理的并发连接的最大数量。

Node.js宣称，运行它的服务器能支持数万个并发连接。Node.js解决这个问题的方法是：更改连接到服务器的方式。每个连接发射一个在Node.js引擎的进程中运行的事件，而不是为每个连接生成一个新的OS线程，以及为此需要分配一些配套资源如内存。Node.js不会死锁，因为它根本不允许使用锁，它不会直接阻塞I/O调用。

优点：
1. 采用事件驱动、异步编程，为网络服务而设计。其实Javascript的匿名函数和闭包特性非常适合事件驱动、异步编程。
2. Node.js非阻塞模式的IO处理给Node.js带来在相对低系统资源耗用下的高性能与出众的负载能力，非常适合用作依赖其它IO资源的中间层服务。
3. Node.js轻量高效，可以认为是数据密集型分布式部署环境下的实时应用系统的完美解决方案。Node非常适合如下情况：在响应客户端之前，您预计可能有很高的流量，但所需的服务器端逻辑和处理不一定很多。
4. 开发者比较容易找到。很多前端设计人员可以很快上手做后端设计。一般公司都不乏Web前端工程师，而此类工程师的学习门槛也非常低。这就意味着Node.js很容易招人，或者公司就隐藏了一些高手强大的社区支持——Node.js社区非常活跃，吸引很多优秀的工程师，这就意味着公司可以很容易从社区得到免费或者付费的支持系统性能考虑——JavaScript引擎Google V8，加之原生异步IO模型，使得Node.js在性能的表现非常出色，处理数以千计的并发请求非常轻松专业公司的支持。

缺点：

1. 可靠性低。默认情况下是单进程，单线程的，一旦这个进程崩掉，那么整个web服务就崩掉了。
2. 默认情况下只支持单核CPU，不能充分的利用多核CPU服务器。
3. 但Javascript是有垃圾回收机制的，这就意味着，系统的响应时间是不平滑的(GC垃圾回收会导致系统这一时刻停止工作)。如果想要构建硬实时应用系统，Erlang是个不错的选择

不过以上缺点可以可以通过代码的健壮性来弥补。目前Node.js的网络服务器有以下几种支持多进程的方式：

1. 开启多个进程，每个进程绑定不同的端口，用反向代理服务器如 Nginx 做负载均衡，好处是我们可以借助强大的 Nginx 做一些过滤检查之类的操作，同时能够实现比较好的均衡策略，但坏处也是显而易见——我们引入了一个间接层。
2. 多进程绑定在同一个端口侦听。在Node.js中，提供了进程间发送“文件句柄” 的功能，这个功能实在是太有用了（貌似是yahoo 的工程师提交的一个patch） ，不明真相的群众可以看这里： Unix socket magic
3. 一个进程负责监听、接收连接，然后把接收到的连接平均发送到子进程中去处理。

在Node.js v0.5.10+ 中，内置了cluster 库，官方宣称直接支持多进程运行方式。Node.js 官方为了让API 接口傻瓜化，用了一些比较tricky的方法，代码也比较绕。这种多进程的方式，不可避免的要牵涉到进程通信、进程管理之类的东西。此外，有两个Node.js的module：multi-node 和 cluster ，采用的策略和以上介绍的类似，但使用这些module往往有一些缺点：

1. 更新不及时
2. 复杂庞大，往往绑定了很多其他的功能，用户往往被绑架
3. 遇到问题难以解决


它不适合CPU使用率较重、IO使用率较轻的应用——如视频编码、人工智能等。Node.js的优势无法发挥简单Web应用——此类应用的特点是，流量低、物理架构简单，Node.js无法提供像Ruby的Rails或者Python的Django这样强大的框架

说服自己老板采用Node.js的方式构建一个简单的原型——花一周时间构建系统某一部分的原型是非常值得的，同时也很容易和老板在某一点达成一致，等到系统真的在某一部分应用了Node.js，就是打开局面的时候寻找开发者——首先JavaScript语言的普及度很高。


